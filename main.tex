%%
%% Copyright (c) 2017 The Authors.  All Rights Reserved.
%%
%% Weitian LI <liweitianux@sjtu.edu.cn>, Haiguang XU <hgxu@sjtu.edu.cn>, et al.
%% School of Physics and Astronomy, Shanghai Jiao Tong University, Shanghai, China.
%%
%% 2017-07-18
%%

\documentclass[modern]{aastex61}
%\documentclass[twocolumn]{aastex61}
%%
%% Defaults: single spaced, 10 point font article
%%
%%  twocolumn   : two text columns, 10 point font, single spaced article.
%%                This is the most compact and represent the final published
%%                derived PDF copy of the accepted manuscript from the publisher
%%  manuscript  : one text column, 12 point font, double spaced article.
%%  preprint    : one text column, 12 point font, single spaced article.
%%  preprint2   : two text columns, 12 point font, single spaced article.
%%  modern      : a stylish, single text column, 12 point font, article with
%%                wider left and right margins. This uses the Daniel
%%                Foreman-Mackey and David Hogg design.
%%
%% Note that you can submit to the AAS Journals in any of these 6 styles.
%%
%% There are other optional arguments one can envoke to allow other stylistic
%% actions. The available options are:
%%
%%  astrosymb    : Loads Astrosymb font and define \astrocommands.
%%  tighten      : Makes baselineskip slightly smaller, only works with
%%                 the twocolumn substyle.
%%  times        : uses times font instead of the default
%%  linenumbers  : turn on lineno package.
%%  trackchanges : required to see the revision mark up and print its output
%%  longauthor   : Do not use the more compressed footnote style (default) for
%%                 the author/collaboration/affiliations. Instead print all
%%                 affiliation information after each name. Creates a much
%%                 long author list but may be desirable for short author papers

%% Extra packages
\usepackage{amsmath}
\usepackage{csquotes}  % `enquote'
\usepackage{xfrac}  % split-level fractions
\usepackage{bm}  % bold math
\usepackage{savesym}

\savesymbol{tablenum}  % workaround symbol conflict
                       % credit: https://tex.stackexchange.com/a/269074
\usepackage{siunitx}  % typeset units; from `texlive-science'
\restoresymbol{SI}{tablenum}  % `tablenum' from `siunitx' becomes `SItablenum'

%% Chinese
\usepackage{xeCJK}
\setCJKmainfont{SimSun}
\setCJKsansfont{KaiTi}
\setCJKmonofont{KaiTi}

%% Bibliography style
\bibliographystyle{aasjournal-links}

%% Custom macros
\newcommand{\etal}{\textit{et~al.}}
\newcommand{\R}[1]{\mathrm{#1}}
\newcommand{\D}[1]{\R{d} #1}
\newcommand{\diff}[2]{\frac{\D{#1}}{\D{#2}}}
\newcommand{\pdiff}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\lcdm}{$\Lambda$CDM}
\newcommand{\Halpha}{\text{H$\alpha$}}
\newcommand{\Hi}{H\textsc{i}}
\newcommand{\Hii}{H\textsc{ii}}
\newcommand{\klos}{\text{$k_{\parallel}$}}
\newcommand{\kperp}{\text{$k_{\bot}$}}

%% Marks
\newcommand{\NOTE}[1]{\textcolor{violet}{\textbf{NOTE:}}~\uwave{#1}}
\newcommand{\TODO}[1]{\textcolor{magenta}{\textbf{TODO:}}~\uuline{#1}}
\newcommand{\OK}[1]{\textcolor{cyan}{\textbf{OK:}}~\uline{#1}}
\newcommand{\XU}[1]{\textcolor{blue}{\textbf{XU:}}~\uline{#1}}
\newcommand{\LI}[1]{\textcolor{purple}{\textbf{LI:}}~\uline{#1}}

%% Custom math operators (requires `amsmath' package)
\DeclareMathOperator{\erf}{erf}
\DeclareMathOperator{\erfc}{erfc}

%% Settings for package `siunitx'
% credit: https://tex.stackexchange.com/a/194042
\sisetup{
  range-phrase=\text{--},
  range-units=single,
  product-units=power
}
%
%% Custom units (requires `siunitx' package)
\DeclareSIUnit\arcsec{arcsec}
\DeclareSIUnit\arcmin{arcmin}
\DeclareSIUnit\cMpc{cMpc}  % comoving Mpc
\DeclareSIUnit\deg{deg}
\DeclareSIUnit\erg{erg}
\DeclareSIUnit\gauss{G}
\DeclareSIUnit\hour{hr}  % overwrite hour from 'h' to 'hr'
\DeclareSIUnit\hubble{\text{$h$}}
\DeclareSIUnit\jansky{Jy}
\DeclareSIUnit\lightyear{ly}
\DeclareSIUnit\parsec{pc}
\DeclareSIUnit\rayleigh{Rayleigh}
\DeclareSIUnit\solarmass{\text{M$_{\odot}$}}
\DeclareSIUnit\year{yr}
%
\DeclareSIUnit\keV{\kilo\electronvolt}
\DeclareSIUnit\kpc{\kilo\parsec}
\DeclareSIUnit\uG{\micro\gauss}
\DeclareSIUnit\Gyr{\giga\year}
\DeclareSIUnit\MHz{\mega\hertz}
\DeclareSIUnit\Mpc{\mega\parsec}


%% Journal information
\received{xxx, 2017}
\revised{xxx, 2017}
\accepted{xxx, 2017}
\submitjournal{ApJ}

\shorttitle{Low-frequency Radio Foreground Simulation}
\shortauthors{Li \etal}

%% You can add a light gray and diagonal water-mark to the first page
%% with this command:
\watermark{DRAFT}
%% where "text", e.g. DRAFT, is the text to appear.  If the text is
%% long you can control the water-mark size with:
%  \setwatermarkfontsize{dimension}
%% where dimension is any recognized LaTeX dimension, e.g. pt, in, etc.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\title{
  Low-frequency Radio Foreground Simulation:
  Extended Radio Emission from Galaxy Clusters
}

%% The \author command is the same as before except it now takes an optional
%% argument which is the 16 digit ORCID. The syntax is:
%% \author[xxxx-xxxx-xxxx-xxxx]{Author Name}
%%
%% This will hyperlink the author name to the author's ORCID page. Note that
%% during compilation, LaTeX will do some limited checking of the format of
%% the ID to make sure it is valid.
%%
%% Use \affiliation for affiliation information. The old \affil is now aliased
%% to \affiliation. AASTeX v6.1 will automatically index these in the header.
%% When a duplicate is found its index will be the same as its previous entry.
%%
%% Note that \altaffilmark and \altaffiltext have been removed and thus
%% can not be used to document secondary affiliations. If they are used latex
%% will issue a specific error message and quit. Please use multiple
%% \affiliation calls for to document more than one affiliation.
%%
%% The new \altaffiliation can be used to indicate some secondary information
%% such as fellowships. This command produces a non-numeric footnote that is
%% set away from the numeric \affiliation footnotes.  NOTE that if an
%% \altaffiliation command is used it must come BEFORE the \affiliation call,
%% right after the \author command, in order to place the footnotes in
%% the proper location.
%%
%% Use \email to set provide email addresses. Each \email will appear on its
%% own line so you can put multiple email address in one \email call. A new
%% \correspondingauthor command is available in V6.1 to identify the
%% corresponding author of the manuscript. It is the author's responsibility
%% to make sure this name is also in the author list.
%%
%% While authors can be grouped inside the same \author and \affiliation
%% commands it is better to have a single author for each. This allows for
%% one to exploit all the new benefits and should make book-keeping easier.
%%
%% If done correctly the peer review system will be able to
%% automatically put the author and affiliation information from the manuscript
%% and save the corresponding author the trouble of entering it by hand.

\correspondingauthor{Haiguang Xu}
\email{hgxu@sjtu.edu.cn}

\author[0000-0002-7527-380X]{Weitian Li}
\email{liweitianux@sjtu.edu.cn}
\affil{School of Physics Astronomy, Shanghai Jiao Tong University,
  800 Dongchuan Road, Shanghai 200240, China}

\author{Haiguang Xu}
\affil{School of Physics Astronomy, Shanghai Jiao Tong University,
  800 Dongchuan Road, Shanghai 200240, China}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{abstract}
\TODO{write the abstract!!!}
\end{abstract}

%% Authors should select subject keywords from the given list.  No more
%% than 6 keywords should be given, and they should be listed in
%% alphabetical order.
%%
%% See the online documentation for the full list of available subject
%% keywords and the rules for their use.
%% http://journals.aas.org/authors/keywords2013.html
\keywords{
  \TODO{[update]}
  dark ages, reionization, first stars ---
  galaxies: clusters: intracluster medium ---
  methods: numerical ---
  radio continuum: galaxies
}


%########################################################################
\section{Introduction}
\label{sec:intro}
%########################################################################

The Epoch of Reionization (EoR; $z \sim \numrange{15}{6}$) is a
cosmological periodization referring to a period of our Universe preceded
by the Cosmic Dawn ($z \sim \numrange{30}{15}$) and the Dark Ages
($z \sim \numrange{200}{30}$).
During the EoR, which lasted from about 300 million to 1 billion years
after the Big Bang, the reionization of neutral hydrogen (\Hi) primarily
caused by the ultra-violet and soft X-ray photons from the first
generation celestial objects surpassed the cooling of the gas through
recombination of electrons and protons.
As a result the majority of baryonic matter was again in highly ionized state.
Comparing with the observations of distant quasars and cosmic microwave
background (CMB), which have provided some loose constraints on the
reionization process, the detection the redshifted 21 cm line emission
from \Hi, especially those from the adjacent regions of the ionized bubbles,
is recognized to be the decisive tool to directly reveal this epoch
\citep[see][for reviews]{zaroubi2013rev,furlanetto2016rev}.

In order to probe the EoR, a number of radio interferometric experiments
working at the \SIrange{\sim 100}{200}{\MHz} low-frequency band have been
designed to target the redshifted 21 cm signals.
These include the LOw Frequency ARray (LOFAR; \citealt{vanHaarlem2013}),
the 21 CentiMeter Array (21CMA; \citealt{zheng2016}),
the Giant Meterwave Radio Telescope (GMRT; \citealt{paciga2011}),
the MIT Epoch of Reionization Experiment (MITEoR; \citealt{zheng2014}),
the Donald C. Backer Precision Array for Probing the Epoch of
Reionization (PAPER; \citealt{parsons2010}),
the Murchison Widefield Array (MWA; \citealt{bowman2013,tingay2013}),
and those to be built and operated in the near future, such as the Square
Kilometre Array (SKA; \citealt{mellema2013rev,koopmans2015rev}) and
the Hydrogen Epoch of Reionization Arrays (HERA; \citealt{deboer2017}).

The challenges in these EoR experiments, however, are particularly
significant due to a variety of complicated instrumental effects
(e.g., intrinsic chromaticity, direction-dependent response, side lobes,
polarization leakages, noises), ionospheric distortions, radio frequency
interference, and the strong celestial foreground contamination.
For example, the intensity of the cumulative foreground sources, which
is mainly contributed by the diffuse polarized synchrotron radiation from
our Milky Way and is complicated by other components, such as the
non-thermal continuum radiation of numerous extragalactic radio sources,
overwhelms the redshifted 21 cm signals by \numrange{4}{5} orders of
magnitude, indicating that even a sub-percent-level bias in modeling
the foreground is sufficient to impede any attempt to recover the EoR
signals \citep[e.g.,][]{beardsley2016,murray2017,procopio2017}.

A variety of approaches have been proposed to tackle the overwhelming
foreground in order to uncover the EoR signals, and they can be classified
into two broad categories: foreground removal (or subtraction) and
foreground avoidance.
Foreground removal refers to the approaches with which the foreground
components are directly separated from EoR signals by applying appropriate
foreground models.
These approaches can be further divided into two families:
the parametric ones \citep[e.g.,][]{wang2006,jelic2008,liu2009,wang2013}
and the non-parametric ones
\citep[e.g.,][]{harker2009,wang2010,chapman2012,chapman2013,gu2013}.
\TODO{[needs improve]}
Foreground avoidance, on the other hand, carries out the EoR analyses
inside the so-called \enquote{EoR window} to avoid the severe foreground
contamination in the 2D cylindrical power spectrum in (\kperp, \klos)
domain, which represent the wavenumbers perpendicular and along the
line of sight, respectively.
In such 2D cylindrical power spectrum, the spectrally smooth foreground
will reside in a well-defined region at small \klos.
The intrinsic chromaticity and other instrumental effects of the
interferometer can throw the angular (i.e., \kperp) foregrounds into
the frequency (i.e., \klos) direction, resulting a wedge-shaped foreground
contaminating region.
Fortunately, an uncontaminated region is expected and dominated by the
EoR signal, defining the \enquote{EoR window}, which has been explored
recently both by simulations
\citep[e.g.,][]{datta2010,thyagarajan2013,thyagarajan2015,barry2016},
by theoretical analyses \citep[e.g.,][]{morales2012,hazelton2013,liu2014},
and by analyzing real observations acquired with, e.g.,
the PAPER \citep{pober2013,ali2015},
the LOFAR \citep{patil2017},
and the MWA \citep{dillon2015,beardsley2016,procopio2017}.

Note, however, that there are advantages and disadvantages for both
approaches
\citep[see][and references therein]{chapman2016}.
For example, foreground removal approaches can keep the information
of EoR at all scales (i.e., all $k$ modes) in the study, but have to
minimize the risk of suffering severe foreground residuals, which is
quite challenging.
Foreground avoidance approaches, on the other hand, deal with the
data free of foreground contamination, but lose a significant part of
the EoR information outside the EoR window.
Also, foreground avoidance strongly depends on the assumption
that the foreground wedge can be well-defined, which may not hold
since the foreground contamination can leak into the EoR window due
to the complicated instrumental and observational effects and
calibration imperfections
\citep[e.g.,][]{barry2016,pober2016,jacobs2016,nunhokee2017}.
Thus the foreground avoidance strategy is by no means optimal, and
removal algorithms are still an active field of research.
\TODO{[补充一两句关于 hybrid method]}

\TODO{[问题: foreground avoidance 与 cluster subtraction 矛盾，需要
  改写该段说法. 我们将采用的评估方法类似 hybrid method.
  补充文献支持我们的方法是合适的...]}
In this paper we attempt to investigate the effects of the contamination
contributed by galaxy clusters (in foreground avoidance???), and discuss
how they can be removed safely in the upcoming SKA experiment.
Among various celestial foreground components, the cluster component is
relatively less discussed, although it may contribute about ??\%
\LI{[星系团对前景的总强度贡献很小，考虑到其数目相对少，覆盖率很低.]}
of the extragalactic foreground power in $50 - 200$ MHz, where the
EoR signals are expected to appear.
As of today, limited by the insufficient sensitivity and the relatively
small sample (about 100 giant/mini radio halos and 70 radio relics),
the origin of the low frequency radio emission of galaxy clusters,
mostly in the form of synchrotron emission, is still poorly understood.
The task of correctly modeling the radio emission of galaxy clusters
becomes more challenging \LI{[为什么??]} when we extend our consideration
to either the faint end or higher redshifts ($z \gtrsim 1$).
\TODO{[问题: 星系团的亮度约为 EoR 信号的 100 倍，但由于覆盖程度低，
  其视场内的总强度不会明显强于 EoR 信号的总强度.]}
Obviously, if the cumulative contribution of both the low-flux cluster
sources and the residuals caused by inaccurate subtraction of the
bright clusters, which is estimated to be about/at least 2?? orders
of magnitude above the EoR signals, is not properly treated, its contamination
will leak into the EoR window due to the interact with instrumental effects
and calibration issues, which becomes an impediment to detection of EoR
signals \citep[e.g.,][]{datta2010,pober2013,beardsley2016,procopio2017}.

This paper is organized as follows.
In Section~\ref{sec:fg-simu} we describe the details of our new software
\texttt{fg21sim}\footnote{FG21sim: \url{https://github.com/liweitianux/fg21sim}}
(version 1) \LI{[release this version on submission]},
which has been developed to simulate the low frequency sky based on the
works of \citet{wang2010,wang2013}.
Comparing to our previous works, the simulations of the Galactic,
and galaxy clusters components have been improved.
In particular, we have significantly enhanced the modeling of galaxy clusters'
emission by applying a merger-induced turbulence re-acceleration model.
Section~\ref{sec:eor-simulation} gives the cosmological EoR signal simulation
using the \texttt{SimFast21}\footnote{SimFast21:
  \url{https://github.com/mariogrs/Simfast21}} (version 20170627)
software \citep{santos2010,hassan2016}.
In Section~??? we model a \SI[product-units=power]{10 x 10}{\deg} deep sky
patch among a \SI{8}{\MHz} band centered at \SI{158}{\MHz}, which is
analogous to those will be observed with SKA1-Low
\citep[see][for updated SKA observing strategies]{koopmans2015rev},
with our software \texttt{fg21sim},
and input the obtained sky model as well as EoR signals into the
\texttt{OSKAR}\footnote{OSKAR: \url{https://github.com/OxfordSKA/OSKAR}}
(version 20170619) with the current available SKA1-Low configuration to
simulate the visibility data sets \citep{mort2010}.
Then we create \enquote{observed} sky images using the
\texttt{WSClean}\footnote{WSClean: \url{https://sourceforge.net/p/wsclean/}}
(version 2.4) with the joined-channel deconvolution
\citep{offringa2014,offringa2017}, from which the 2D cylindrical power spectra
are calculated by fast Fourier transformation.
In Section~??? we quantitatively examine to what extent the EoR window is
contaminated by the residuals contributed by mis-subtracted and un-subtracted
galaxy clusters.

We adopt a flat \lcdm{} cosmology throughout this work with
$H_0 = \SI{100}{\hubble} = \SI{71}{\km\per\second\per\Mpc}$,
$\Omega_m = 0.27$, $\Omega_{\Lambda} = 1 - \Omega_m = 0.73$,
$\Omega_b = 0.046$, $n_s = 0.96$, and $\sigma_8 = 0.81$
\citep{komatsu2011}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\noindent\hrulefill~\LI{[OLD]}~\hrulefill
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

In addition, galaxy clusters are also important objects of study in their
own right:
\LI{[需增强/突出]}
\begin{itemize}
  \item elements to form the large-scale structures, key to understand the
    structure formation and evolution of the Universe;
  \item merger-induced turbulence and shocks accelerate electrons to produce
    extended halos and relics, respectively, enable us to trace cluster
    mergers and formations with radio techniques;
  \item great laboratory to study the origin of cosmic rays, particle
    acceleration, magnetic growth and distribution, etc.
\end{itemize}

Extended radio emissions are only observed in a small fraction of massive
and luminous galaxy clusters, and they are more rarely found in smaller
clusters.
These extended radio emissions can be roughly classified into three types
\citep[see][for recent reviews]{feretti2012rev,brunetti2014rev}:
\XU{[模拟之中务必包含这几类. 另, 有多少既亮又延展的 cluster 源会出现在
  视场之中? 这个数字(比例)也许应该体现在 introduction 之中.]}
\begin{description}
  \item[Halos]
    giant and extend on \si{\sim \Mpc} scales;
    They are only found at the center of galaxy clusters showing major
    merging features, and have regular morphology without significant
    polarization.

    The \emph{turbulence re-acceleration model} (also known as the
    \emph{primary electrons model}) is the most accepted model to explain
    the origin of radio halos.
    In this model, major mergers between clusters generate turbulence
    throughout the cluster ICM, which interact with the existing low-energy
    electrons to accelerate them to higher energies (e.g., $\gamma > 1000$),
    and then these relativistic electrons radiate synchrotron emissions
    within ICM's \si{\uG}-level magnetic field, to be responsible for the
    radio halos.
    On the other hand, there is the \emph{hadronic model}, which is also
    known as the \emph{secondary electrons model}.

    Currently we have only discovered $\lesssim\,$80 radio halos
    \citep{kale2016rev,duchesne2017}, and a much larger sample is a
    necessity to well constrain the halo models, in order to further reveal
    the physical processes.

  \item[Mini-halos]
    smaller than the above giant halos (usually several hundreds of kpc);
    currently only \num{\sim 20} of them have been found, generally located
    at the center of relaxed cool-core clusters \citep{bravi2016};
    their origin is still poorly known, but is different to that of giant
    halos, and is argued to be related with the turbulence in the cool-core
    region and AGN feedback \citep{gitti2015rev}.

  \item[Relics]
    typically are elongated and may stretch over \si{\sim \Mpc} scales;
    located in cluster peripheral regions of both merging and relaxed
    clusters, suggesting that they may be related to minor or off-axis
    mergers, as well as to major mergers \citep{feretti2012rev}.
    The strongly polarized (\SIrange{\sim 20}{30}{\percent}) emission is
    one of the most important distinction compared to halos and mini-halos.

    Apart from the typical elongated relics, there are also the so-called
    roundish relics, showing a more regular and roundish morphology,
    and they are generally distributed closer to the cluster center.
    Their different properties with respect to the elongated relics
    suggest a different origin.

    Only in \num{\sim 70} clusters have been observed radio relics
    \citep[their Table 1]{nuza2017} for the moment, and more observational
    evidences are required to better understand their nature.
\end{description}

Due to their low surface brightness and steep spectra, these extended
radio emissions from galaxy clusters are difficult to find at middle-
or high-frequency ranges (e.g., \SI{1.4}{\GHz}).
However, they become much brighter and thus easier to be detected in
the low-frequency radio band.  The large field of view (FoV) of the
low-frequency interferometer also helps discover them more efficiently.
Owing to its excellent sensitivity, the SKA will possibly discover more
than several thousands of halos and relics, providing us with invaluable
data to understand and solve the puzzles with regard to galaxy clusters.
Furthermore, the faint radio sky can be very different, and we may have
unexpected findings as we go deeper \citep{padovani2016rev,herreraRuiz2017}.

%########################################################################
% \section{Foreground Simulation}
\section{SIMULATION OF $?? - ??$ MHz SKY WITH fg21sim}
\label{sec:fg-simu}
%########################################################################

Based on the work of Wang et al. (2010), we have used the Python programming
language to develop a tool fg21sim【斜体??黑体??】 to simulate the
low-frequency radio sky by taking into account the contributions of Our
Galaxy, discrete extragalactic sources, galaxy clusters, epoch of
reionization, and instrument noise. The software is public to the community
and can be downloaded at https://github.com/liweitianux/fg21sim, where
technical details, a user manual and other auxiliary documents are also
provided. An interface?? is designed in the software to employ instrumental
responses of different low-frequency radio facilities. In this work we use
its latest version fg21sim【斜体??黑体??】 v?? to generate sky images and
evaluate the effects of the contamination caused by galaxy clusters. By
consulting the plan/white book/guid??【SKA相关文献的正式官方名称、版本】
(ref??), we perform the simulations in $?? - ??$ MHz for a
$10^{\circ} \times 10^{\circ}$??【先写大的模拟区域；其中取出多少计算，后面再提】
sky region at a high galactic latitude of ??, which resembles those that will
be observed with SKA array in the future 【虽然可以引述MWA文献，但必须以
SKA为重!!；脚注：This covers the same sky field as MWA (EoR0 field;
Beardsley et al. 2016】, and only incorporate the Galactic and cluster
foreground components in the simulated sky maps. The contamination of the
extragalactic sources are neglected,
because to ?? (ref??) 【说明：1、21cm信号应存在，否则后面也无法比较——只是
后文在谈前景时，必要时说明那里只计算了前景、未含21cm信号即可；2、河外点源略
去会有什么影响、略去的依据是什么，要做清晰简略的说明，并引用文献；3、马、单
的论文是否提及，待定。可做一标记以提示】. When we model the Galactic
contamination, the emission from supernova remnants (SNRs), some of which
may have a large angular size and a complex morphology, is also neglected
because the total number of these sources is small (about 1000; Li et al.
1991; Anderson et al. 2017) and they prefer to reside in the Galactic plane.
We project the sky maps to a flat plane using the azimuthal equidistant
projection??, and the obtained images are overlaid with grids of 1024 ×
1024 pixels, each pixel covering approximately a $?? \times ??$?? patch.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\noindent\hrulefill~\LI{[OLD]}~\hrulefill
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\XU{目标之中: 多大范围? 什么尺度? 应描写前景模拟软件... 并加以量化,
  说明此工作的重大进步/意义.}

At the low-frequency radio band, the foreground emission of various
origins is generally \numrange{4}{5} orders of magnitude stronger
than the EoR signal of our interest.
The diffuse Galactic synchrotron and free-free emissions contaminate
the target signal at large spatial scales ($\sim\,$degrees),
meanwhile the radio halos and extragalactic point sources affect the
small spatial scales ($\sim\,$arcminutes to arcseconds).
Fortunately, all these kinds of foreground emissions posses a smooth
spectrum, compared to the target EoR signal, and this important
difference is our last resort to surmount the overwhelming foreground.
To achieve the detection of the very faint EoR signal, we must
develop a targeted and sophisticated method to accurately remove the
foreground contamination.
In consequence, an as realistic as possible simulation of the
low-frequency radio foreground is a necessity and of great importance,
which can improve our understandings of all these different foreground
emissions on the one hand, and provide us with both guidelines for
developing targeted foreground removal methods as well as the
evaluation data on the other hand.

In this section, we first introduce how to simulate the Galactic
synchrotron (unpolarized) emission, and Galactic free-free emission.
Then we describe in details the physically motivated method we proposed
to simulate the extended radio halos from galaxy clusters.
\LI{[add radio relics]}
Considering that we focus on simulating the radio halos from galaxy
clusters and evaluating their impacts on the EoR detection experiments,
we have left out the foreground emissions from Galactic supernova remnants
(SNRs) and extragalactic point sources in this work.
Although Galactic SNRs may have large angular sizes and complicated
morphologies, the total number is only \num{\sim 1000} \citep{li1991,anderson2017}
and they are mostly distributed around the Galactic plane.
The EoR target fields are at high Galactic places, where the
Galactic synchrotron intensity is also much lower, we argue that
the Galactic SNRs can be safely ignored for the moment.
With regard to the extragalactic point sources, they are the second
dominant foreground component next to the Galactic synchrotron emission,
and a careful simulation to this component is also important.
We are developing a better simulation method by making use of the
deep learning and convolutional auto-encoders (CAE) algorithms, for the
sake of achieving a more rational classification and more sophisticated
morphologies for the point sources
(Ma et al. in preparation; Shan et al. in preparation).

\LI{[needs update]}
We have implemented the proposed foreground simulation techniques in the
\texttt{fg21sim} open-source software available at
\url{https://github.com/liweitianux/fg21sim}.
The software is written in the Python programming language from scratch.
It is well designed and implemented, and we keep in mind that it should
be easy to use and to extend in the future.
The software will continuously evolve as we understand the foreground
more thoroughly, or have access to better observational evidences.
We also provide some utilities to make it easier to integrate the
software with the subsequent observation simulation, as we described
in Section~\ref{sec:obs-simulation}.

%% BEGIN: [7th->8th]
\color{magenta}\sout{%
According to the current published specifications \mbox{\citep{dewdney2015ska}},
the SKA1-Low interferometer consists of antenna stations of \mbox{\SI{35}{\meter}}
in diameter, and has baselines up to \mbox{\SI{\sim 65}{\kilo\meter}},
which corresponds to a FoV of \mbox{\SI{\sim 4 x 4}{\deg}}
and angular resolution of \mbox{\SI{\sim 7}{\arcsec}} at \mbox{\SI{158}{\MHz}}.
In this work, we simulate the foreground emissions within a sky
patch of \mbox{\SI{10 x 10}{\deg}} centered at
(R.A., Dec.) = (\mbox{\SI{0}{\degree}}, \mbox{\SI{-27}{\degree}}),
the \mbox{\enquote{EoR0}}
field identified by the MWA \mbox{\citep{beardsley2016}}.
\NOTE{[10 deg may be too small to account for the side lobes!]}
The simulated foreground sky is large enough to not only take into
account the side lobes of the interferometer, but also help the
imaging procedure in the observation simulation stage.
}\color{black}
%% END: [7th->8th]


%========================================================================
\subsection{Galactic Synchrotron Emission}
\label{sec:fg-gsync}
%========================================================================

The diffuse Galactic synchrotron emission, the spectrum of which can be well
characterized by a power-law with
the index $\alpha_{\rm syn}$ varying with the position in the sky, is the
dominating foreground component in detection
of EoR signals. For example, at about 150 MHz this emission component
accounts for about ??\% of the Galactic contamination
and about 70\% of the total foreground intensity (ref??; Shaver et al.
1999). To simulate this foreground component
we employ the improved 408 MHz sky map provided in Remazeilles et al.
(2015), which was obtained by applying
significantly better instrument calibration and more accurate subtraction of
extragalactic sources, and calculate
the Galactic synchrotron emission map as
\begin{equation}
  %\label{eq:gsync-extrap}
  T_b^{\R{syn}}(\bm{r}, \nu) = T_b^{\R{Haslam}}(\bm{r})
    \left( \frac{\nu}{\SI{408}{\MHz}} \right)^{-\alpha_{\R{syn}}(\bm{r})},
\end{equation}
where $T_b^{\R{syn}}(\bm{r}, \nu)$ is the emission intensity expressed in
brightness temperature at sky position $\bm{r}$ and
frequency $\nu$, and $\alpha_{\rm syn} \sim ?? -??$ is the
position-dependent synchrotron spectral index. $\alpha_{\rm syn}$
is determinged by adopting the all-sky synchrotron spectral index map of
Giardino et al. (2002), which was derived by
comparing the Haslam 408 MHz all-sky survey with the northern sky continuum
survey at 1420 MHz (Reich \& Reich 1986) and
the southern sky survey at 2326 MHz (Jonas et al. 1998). The resulting
$?? - ??$ MHz Galactic synchrotron emission maps
are pixelized using the HEALPix algorithm (Gorski et al. 2005) and keep the
same spatial resolution (about 1.72 arcmin) as
the improved 408MHz map of Remazeilles et al. (2015), which is achieved by
by extrapolating the observed angular power spectrum
to small scales.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\noindent\hrulefill~\LI{[OLD]}~\hrulefill
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The diffuse Galactic synchrotron emission dominates the low-frequency
radio sky and accounts for \SI{\sim 70}{\percent} of the foreground
intensity at \SI{\sim 150}{\MHz} \citep{shaver1999}.
It has a power-law spectrum\footnote{We adopt the power-law
  spectrum of form: $S(\nu) \propto \nu^{-\alpha}$.}
with the spectral index $\alpha_{\R{syn}}$ varying as sky positions.
We can simulate this foreground component at wanted low frequencies
by extrapolating from the Haslam \SI{408}{\MHz} all-sky template
\citep{haslam1982}.

The Haslam \SI{408}{\MHz} all-sky map is one of the most important
observations at the low-frequency regime, though has a rather limited
resolution of \SI{\sim 56}{\arcmin}.
\citet{remazeilles2015} have reprocessed the rawest available data
and obtained a much improved Haslam \SI{408}{\MHz} map\footnote{%
  The 2014 reprocessed Haslam \SI{408}{\MHz} map:
  \url{http://www.jb.man.ac.uk/research/cosmos/haslam_map/}}
with significantly better calibration and extragalactic source removal,
they also produced the higher resolution maps with mock small-scale
fluctuations added, which were simulated by extrapolating the observed
angular power spectrum to small scales.
The all-sky maps are pixelized using the HEALPix algorithm \citep{gorski2005}.
We use the $N_{\R{side}} = 2048$ (i.e., pixel size \SI{\sim 1.72}{\arcmin})
Haslam \SI{408}{\MHz} map released by \citet{remazeilles2015} as the
template in this work.
At even smaller scales, we do not have sufficient observational
evidences to guide or constrain the simulation.  In addition, there
are galaxy clusters and extragalactic point sources contaminating
the EoR signal at such small scales, we therefore argue that our
treatment to the Galactic synchrotron emission should be enough in
the current simulation framework.

We extrapolate from the adopted Haslam \SI{408}{\MHz} template map
$T_b^{\R{Haslam}}(\bm{r})$ to the wanted lower frequency $\nu$ by assuming
a power-law spectrum \citep{wang2010,bonaldi2015}:
\begin{equation}
  \label{eq:gsync-extrap}
  T_b^{\R{syn}}(\bm{r}, \nu) = T_b^{\R{Haslam}}(\bm{r})
    \left( \frac{\nu}{\SI{408}{\MHz}} \right)^{-\alpha_{\R{syn}}(\bm{r})},
\end{equation}
where $T_b^{\R{syn}}(\bm{r}, \nu)$ is the Galactic synchrotron intensity
expressed in brightness temperature at sky position $\bm{r}$ and
frequency $\nu$,
%% BEGIN: [7th->8th]
\color{magenta}
and $\alpha_{\R{syn}}(\bm{r}) \sim 2.7$ is
the position-dependent synchrotron spectral index.
We use the all-sky map of synchrotron spectral index made by
\citet{giardino2002}, which was derived from the Haslam \SI{408}{\MHz}
all-sky survey and the northern sky continuum survey at \SI{1420}{\MHz}
\citep{reich1986} combined with the southern sky survey at
\SI{2326}{\MHz} \citep{jonas1998}.
\color{black}
%% END: [7th->8th]


%========================================================================
\subsection{Galactic Free-Free Emission}
\label{sec:fg-gfree}
%========================================================================

Observations of diffuse H$_{\alpha}$ and radio recombination line emissions
from both the Galactic plane and high galactic latitudes
indicate the existance of a population of free electrons, which is generated
by processes such as star formation and supernova explosions.
The bremsstrahlung radiation of these free electrons is expected to
contribute about ??\% of the total Galactic foreground in
$?? - ??$ MHz (ref??). Thus, similar to, e.g., Wang et al. (2010), we
calculate the Galactic free-free emission map $T_b^{\R{ff}}(\bm{r}, \nu)$
by using the relation given in Dickinson et al. (2003)
\begin{equation}
  %\label{eq:halpha-ff}
  T_b^{\R{ff}}(\bm{r}, \nu) = 38.86 \, a(\nu, T_e) \nu^{-2.1}
    10^{(290 / T_e)} \, T_e^{0.667}
    \left[ \frac{I_{\Halpha}^{\R{corr}}(\bm{r})}{\si{\rayleigh}} \right]
    \quad [\si{\kelvin}],
\end{equation}
where $\nu$ is the target frequency in units of \si{\MHz}, $T_e$ is the
electron temperature in units of \si{\kelvin},
the factor $a(\nu, T_e) = 0.183 \,\nu^{0.1} T_e^{-0.15} [ 3.91 - \ln \nu +
1.5 \ln T_e ]$ is ??【如is the correction for.../is used to compensate
for...】,
and $I_{\Halpha}^{\R{corr}}$ is the H$_{\alpha}$ map corrected for dust
absorption. According Dickinson et al. (2003) is calculated as
\begin{equation}
  %\label{eq:halpha-dust-corr}
  I_{\Halpha}^{\R{corr}}(\bm{r}) = I_{\Halpha}(\bm{r}) \times
    10^{D(\bm{r}) \times 0.0185 \times f_d},
\end{equation}
where $I_{\Halpha}(\bm{r})$ is the observed \Halpha{} intensity at sky
position $\bm{r}$ in units of \si{\rayleigh},
$D(\bm{r})$ is the measured dust column density in units of
\si{\mega\jansky\per\steradian},
and $f_d$ is the effective dust fraction along the line of sight.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\noindent\hrulefill~\LI{[OLD]}~\hrulefill
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The diffuse Galactic free-free emission due to the bremsstrahlung
radiation from diffuse ionized interstellar medium (ISM),
e.g., \Hii{} regions, contributes only \SI{\sim 1}{\percent} of the total
foreground emission in the low frequencies of interest.
It cannot be directly measured by current facilities since it is too
weak compared to the above synchrotron emission.
Nevertheless, the ionized ISM generates both radio free-free continuum
and \Halpha{} emission, and the relationship between these two kinds of
emissions can be determined under certain assumptions \citep{dickinson2003}.
Therefore we can derive the Galactic free-free emission based on the
all-sky \Halpha{} survey data.
However, the \Halpha{} emission suffers from the dust absorption, which
may be very severe for regions near the Galactic plane
(e.g., $|b| < \SI{5}{\degree}$).

Compared to our previous work \citep{wang2010}, we account for the
dust absorption of the \Halpha{} emission by following the approach
proposed by \citet{dickinson2003}.
As we mentioned before, the EoR detection experiments mainly target
the high Galactic regions, so we can ignore the absorption correction
problems around the Galactic plane.
Nevertheless, we are also working on a more sophisticated and
physical model to simulate the Galactic free-free emission at the low
frequency regime (Lian et al. in preparation).

\NOTE{[连: (1) 请补充一下你的研究内容和目标;
  (2) 请检查此小节内容是否有正确; (3) 请帮忙适当增强/改进.]}

First, the observed \Halpha{} map should be corrected for the dust
absorption \citep{dickinson2003}:
\begin{equation}
  \label{eq:halpha-dust-corr}
  I_{\Halpha}^{\R{corr}}(\bm{r}) = I_{\Halpha}(\bm{r}) \times
    10^{D(\bm{r}) \times 0.0185 \times f_d},
\end{equation}
where $I_{\Halpha}(\bm{r})$ is the observed \Halpha{} intensity at sky
position $\bm{r}$ in units of \si{\rayleigh},
$D(\bm{r})$ is the measured dust column density in units of
\si{\mega\jansky\per\steradian},
and $f_d$ is the effective dust fraction along the line of sight actually
absorbing the \Halpha{} emission.

Then we can convert the absorption-corrected \Halpha{} intensity
$I_{\Halpha}^{\R{corr}}(\bm{r})$ to the free-free emission brightness
temperature $T_b^{\R{ff}}(\bm{r}, \nu)$
using the relationship \citep{dickinson2003}
\footnote{Their formula has a superfluous factor of $10^3$.}:
\begin{equation}
  \label{eq:halpha-ff}
  T_b^{\R{ff}}(\bm{r}, \nu) = 38.86 \, a(\nu, T_e) \nu^{-2.1}
    10^{(290 / T_e)} \, T_e^{0.667}
    \left[ \frac{I_{\Halpha}^{\R{corr}}(\bm{r})}{\si{\rayleigh}} \right]
    \quad [\si{\kelvin}],
\end{equation}
where $\nu$ is the target frequency in units of \si{\MHz},
$T_e$ is the electron temperature in units of \si{\kelvin},
and the factor $a(\nu, T_e)$ is given by:
\begin{equation}
  a(\nu, T_e) = 0.183 \,\nu^{0.1} T_e^{-0.15}
    \, [ 3.91 - \ln \nu + 1.5 \ln T_e ].
\end{equation}

In this work, we use the all-sky \Halpha{} map from \citet{finkbeiner2003},
the all-sky dust map from \citet{schlegel1998}, and
adopt effective dust fraction $f_d = 0.33$ and
electron temperature $T_e = \SI{7000}{\kelvin}$
as suggested \citep{dickinson2003}.


%========================================================================
\subsection{Galaxy Clusters}
\label{sec:fg-clusters}
%========================================================================

We have significantly improved the model in our previous work (Wang et al.
2010) to simulate the contribution of galaxy clusters
to the EoR foreground by taking into account detailed merging history of
clusters, which is established within the frame of
the extended Press-Schechter theory (e.g., Bond et al. 1991; Lacey \& Cole
1993; see also Press \& Schechter 1974), and by
tracing the evolution of a radio halo or a radio relic via solving the
Fokker-Planck equation.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\noindent\hrulefill~\LI{[OLD]}~\hrulefill
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\XU{(1) 简要说明此工作的重大改进; (2) 说明算法及指标, 并适当量化.}

\TODO{Rewrite this overview!!!}

In the framework of low-frequency radio foregrounds simulation for the
EoR signal detection, the most realistic consideration to the galaxy
clusters component to date is our previous work in \citeyear{wang2010}
\citep{wang2010}.
In this work, we continue to improve our simulation method in several
ways: \LI{[需改进]}
(1) Predict radio halos by tracing the most recent major merger of clusters;
(2) Determine the halo brightness and spectrum by solving the time
evolution of relativistic electrons within the cluster ICM.
We present our improved simulation method to the galaxy clusters in this
section.

\TODO{[Include radio relics, and update the descriptions.]}
\TODO{[Explain the exclusion of mini-halos and roundish relics!]}


%------------------------------------------------------------------------
%\subsubsection{Distributions}
\subsubsection{Halo Distribution}
\label{sec:distributions}
%------------------------------------------------------------------------

The Press-Schechter formalism was originally advanced as one of the standard
method to predict the mass function of galaxy clusters and its evolution
in the Universe (\citet{press1974}), and has been extended to combine with
the cold dark matter (CDM) models \citep[e.g.,][]{bond1991,lacey1993}.
According to the extended Press-Schechter theory, the number density (i.e.,
the number per unit comoving volume per unit mass) of galaxy clusters
at a certain redshift $z$ is given by
\begin{equation}
  %\label{eq:ps-mass-func}
  n(M, z) \,\D{M} = \sqrt{\frac{2}{\pi}} \frac{\langle{\rho}\rangle}{M}
  \frac{\delta_c(z)}{\sigma^2(M)} \left| \diff{\sigma(M)}{M} \right|
  \exp\!\left[ -\frac{\delta_c^2(z)}{2\sigma^2(M)} \right] \D{M},
\end{equation}
where
$M$ is the cluster mass,
$\langle {\rho} \rangle$ is the current mean density of the Universe,
$\delta_c(z)$ is the critical linear overdensity for a region to collapse
at redshift $z$ [see Equation~(\ref{eq:delta-crit})],
and $\sigma(M)$ is the current rms (root-mean-square) density fluctuations
within a sphere of mean mass $M$.

Considering the CDM model and the halo mass range covered by galaxy
clusters, it is reasonable to adopte a power-law distribtuion
for the density perturbations (Sarazin 2002; Randall et al. 2002), i.e.,
\begin{equation}
  %\label{eq:sigma-mass}
  \sigma(M) = \sigma_8 \left( \frac{M}{M_8} \right)^{-\alpha},
\end{equation}
where $\sigma_8$ is the present-day rms density fluctuations on a
scale of \SI{8}{\per\hubble\Mpc},
$M_8 = (4\pi/3)(8 \,\si{\per\hubble\Mpc})^3 \langle{\rho}\rangle$
is the mass contained in a sphere of a radius \SI{8}{\per\hubble\Mpc},
and the exponent $\alpha = (n+3)/6$ is related to the pattern of
fluctuations
as the power spectrum of fluctuations varies with wavenumber $k$ as $k^n$.
Here we follow \citep{randall2002} and adopt $n = -7/5$.

Then, by placed a conservative minimum mass cut of $M_{\R{min}} \simeq
\SI{1.4e14}{\solarmass}$ \citep{zandanel2014},
we are able to use Eq. ?? to calculate both the total number and the
distribution of galaxy clusters for any given sky patch.
The mass, redshift, and sky position of each simulated cluster can be
determined randomly using Monte Carlo method \citep{wang2010}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\noindent\hrulefill~\LI{[OLD]}~\hrulefill
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The Press-Schechter formalism is one of the standard method to predict
the mass function of galaxy clusters and its evolution as the Universe.
It is originally developed by \citet{press1974}, and later extended to
combine with the cold dark matter (CDM) models
\citep[e.g.,][]{bond1991,lacey1993}.
The Press-Schechter mass function $n(M, z)$ describes the cluster
number density (i.e., number per unit comoving volume) per unit mass
at a redshift of $z$, and is given by \citep{press1974}:
\begin{equation}
  \label{eq:ps-mass-func}
  n(M, z) \,\D{M} = \sqrt{\frac{2}{\pi}} \frac{\langle{\rho}\rangle}{M}
  \frac{\delta_c(z)}{\sigma^2(M)} \left| \diff{\sigma(M)}{M} \right|
  \exp\!\left[ -\frac{\delta_c^2(z)}{2\sigma^2(M)} \right] \D{M},
\end{equation}
where
$M$ is the cluster mass,
$\langle {\rho} \rangle$ is the current mean density of the Universe,
$\delta_c(z)$ is the critical linear overdensity for a region to collapse
at redshift $z$ [see Equation~(\ref{eq:delta-crit})],
and $\sigma(M)$ is the current rms (root-mean-square) density fluctuations
within a sphere of mean mass $M$.

In CDM models and within the range of scales covered by clusters,
it is generally sufficient to consider a power-law spectrum
for the density perturbations \citep{sarazin2002,randall2002}:
\begin{equation}
  \label{eq:sigma-mass}
  \sigma(M) = \sigma_8 \left( \frac{M}{M_8} \right)^{-\alpha},
\end{equation}
where $\sigma_8$ is the present-day rms density fluctuations on a
scale of \SI{8}{\per\hubble\Mpc},
$M_8 = (4\pi/3)(8 \,\si{\per\hubble\Mpc})^3 \langle{\rho}\rangle$
is the mass contained in a sphere of radius \SI{8}{\per\hubble\Mpc}.
The exponent $\alpha$ is given by $\alpha = (n+3)/6$, where
the power spectrum of fluctuations varies with wavenumber $k$
as $k^n$, and we adopt $n = -7/5$ for this work \citep{randall2002}.

We place a minimum mass limit of $M_{\R{min}} \simeq \SI{1.4e14}{\solarmass}$
\LI{[update this parameter]} for the galaxy clusters \citep{zandanel2014}.
The total number of clusters within a certain sky patch can be
determined by the Press-Schechter mass function, and then the mass
$M_0$ and redshift $z_0$ of each cluster can be drawn from the mass
function using Monte Carlo method \citep{wang2010}.
The clusters are randomly distributed within the sky patch.


%------------------------------------------------------------------------
\subsubsection{Merging History}
\label{sec:merging-history}
%------------------------------------------------------------------------

We employ the extended Press-Schechter theory and the method outlined in
\citet{lacey1993} to generate merger trees,
and will use them to describe the merging history of galaxy clusters in
\S??. For each merger tree to be built,
we start with an initial cluster, whose redshift $z_{0}$ and mass $M_{0}$
are randomly determined by applying Eq.??【上一节密度分布公式】.
We trace the merging history of this cluster back in time by running
Monte-Carlo simulations to randomly determine the mass increase
$\Delta M$ at each step, which may be caused either by a real merger (if
$\Delta M > \Delta M_c$, where $\Delta M_c = \SI{e12}{\solarmass}$
is the minimum mass change in the merger tree, i.e., the smallest infalling
sub-cluster that can be resolved)
or by accretion  (if $\Delta M \leq \Delta M_c$). Whenever a real merger
occurs, we also begin to trace the merging history
of new sub-cluster.

We assume that during each step of mass increase the mass of the cluster
increases from $M_{1}$ at time $t_{1}$ to $M_{2}$ at $t_{2}$.
Given $M_{2}$, the conditionl probability of the cluster's progenitor being
in the mass range $M_{1} \to M_{1} + \D{M_{1}}$
can be expressed as
\begin{equation}
  %\label{eq:eps-condprob}
  \R{Pr}(M_1, t_1 | M_2, t_2) \,\D{M_1} = \frac{1}{\sqrt{2\pi}}
\frac{M_2}{M_1}
  \frac{\delta_{c1} - \delta_{c2}}{(\sigma_1^2 - \sigma_2^2)^{3/2}}
  \left| \diff{\sigma_1^2}{M_1} \right|
  \exp \!\left[ -\frac{(\delta_{c1} - \delta_{c2})^2}
    {2(\sigma_1^2 - \sigma_2^2)} \right] \D{M_1},
\end{equation}
where
$\delta_{ci} \equiv \delta_c(t_i)$, $\sigma_i \equiv \sigma(M_i)$, and $i =
1, 2$ is used to denote parameters defined at the time $t_{1}$ and $t_{2}$,
respectively (\citep{lacey1993,randall2002}).
If we further introduce $S \equiv \sigma^2(M)$ and $\omega \equiv
\delta_c(t)$, whose differences between $t_{1}$ and $t_{2}$
are $\Delta S = \sigma_1^2 - \sigma_2^2$ and $\Delta S \to \Delta S +
\D{\Delta S}$, Equation~(\ref{eq:eps-condprob}) reduces to
\begin{equation}
  %\label{eq:eps-condprob-simp}
  \R{Pr}(\Delta S, \Delta \omega) \,\D{\Delta S} = \frac{1}{\sqrt{2\pi}}
  \frac{\Delta\omega}{(\Delta S)^{3/2}}
  \exp \!\left[ -\frac{(\Delta\omega)^2}{2 \Delta S} \right] \D{\Delta S}.
\end{equation}

In order to obey the probability distribution of mergers with different
$\Delta M$ (i.e., $\Delta S$),
we sample the cumulative probability distribution of $\Delta M$ with
\begin{equation}
  %\label{sec:cdf-sub-masses}
  \R{Pr}(<\!\Delta S, \Delta\omega) =
  \int_0^{\Delta S} \R{Pr}(\Delta S', \Delta\omega) \,\D{\Delta S'} =
  \erfc \!\left( \frac{\Delta \omega}{\sqrt{2 \Delta S}} \right),
\end{equation}
where $\erfc(x) = 1 - \erf(x)$ is the complementary error function.
With a random $\Delta S$ (i.e., $M_{\rm sub}$) drawn from this probability
distribution, the values of $S_1$ and $M_{1}$
are derived for the progenitor in each merger.
In the calculation, the step size $\Delta\omega$ is chosen adaptively
\citep{randall2002} using
\begin{equation}
  %\label{sec:dw-step}
  (\Delta\omega)_{\R{step}} \lesssim \frac{1}{2} \left[
    S \left| \diff{\ln \sigma^2}{\ln M} \right|
    \left( \frac{\Delta M_c}{M} \right) \right]^{1/2},
\end{equation}
where $M$ is the cluster mass at a certain step.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\noindent\hrulefill~\LI{[OLD]}~\hrulefill
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Galaxy clusters are formed hierarchically by merging from smaller (i.e.,
lower mass) clusters, groups, and galaxies.
And the PS formalism provides a way to infer the formation history
of a cluster from its current status.
We follow the extended Press-Schechter method outlined by \citet{lacey1993}
to generate the merger trees.

The conditional probability that a \enquote{parent} cluster of mass $M_2$
at a time $t_2$ had a \enquote{progenitor} of mass in the range
$M_1 \to M_1 + \D{M_1}$ at some earlier time $t_1$,
with $M_2 > M_1$ and $t_2 > t_1$, is given by
\citep{lacey1993,randall2002}:
\begin{equation}
  \label{eq:eps-condprob}
  \R{Pr}(M_1, t_1 | M_2, t_2) \,\D{M_1} = \frac{1}{\sqrt{2\pi}} \frac{M_2}{M_1}
  \frac{\delta_{c1} - \delta_{c2}}{(\sigma_1^2 - \sigma_2^2)^{3/2}}
  \left| \diff{\sigma_1^2}{M_1} \right|
  \exp \!\left[ -\frac{(\delta_{c1} - \delta_{c2})^2}
    {2(\sigma_1^2 - \sigma_2^2)} \right] \D{M_1},
\end{equation}
where
$\delta_{c1} \equiv \delta_c(t_1)$ and $\sigma_1 \equiv \sigma(M_1)$,
with similar definitions for $\delta_{c2}$ and $\sigma_2$.
By further defining $S \equiv \sigma^2(M)$ and $\omega \equiv \delta_c(t)$,
and let $\R{Pr}(\Delta S, \Delta \omega) \,\D{\Delta S}$ be the probability
that a cluster had a progenitor with a mass corresponding to a change
in $S$ of $\Delta S = \sigma_1^2 - \sigma_2^2$ in the range
$\Delta S \to \Delta S + \D{\Delta S}$ at an earlier time
corresponding to $\Delta \omega = \delta_{c1} - \delta_{c2}$,
then Equation~(\ref{eq:eps-condprob}) is simplified into:
\begin{equation}
  \label{eq:eps-condprob-simp}
  \R{Pr}(\Delta S, \Delta \omega) \,\D{\Delta S} = \frac{1}{\sqrt{2\pi}}
  \frac{\Delta\omega}{(\Delta S)^{3/2}}
  \exp \!\left[ -\frac{(\Delta\omega)^2}{2 \Delta S} \right] \D{\Delta S}.
\end{equation}

We employ the standard Monte Carlo technique to build the merger trees,
with each of them starts with a cluster with an initial mass $M_0$
and redshift $z_0$ simulated in the last section.
We trace each cluster back in time, using a step size $\Delta\omega$
adaptively determined by \citep{randall2002}:
\begin{equation}
  \label{sec:dw-step}
  (\Delta\omega)_{\R{step}} \lesssim \frac{1}{2} \left[
    S \left| \diff{\ln \sigma^2}{\ln M} \right|
    \left( \frac{\Delta M_c}{M} \right) \right]^{1/2},
\end{equation}
where $M$ is the cluster mass at the current time step,
$\Delta M_c$ is the minimum mass change indicating the smallest
merging sub-cluster can be resolved in the merger trees;
and we choose $\Delta M_c = \SI{e12}{\solarmass}$.
In order to obey the probability distribution of mergers of different
$\Delta S$ (i.e., $\Delta M$), we sample the cumulative probability
distribution of the sub-cluster masses:
\begin{equation}
  \label{sec:cdf-sub-masses}
  \R{Pr}(<\!\Delta S, \Delta\omega) =
  \int_0^{\Delta S} \R{Pr}(\Delta S', \Delta\omega) \,\D{\Delta S'} =
  \erfc \!\left( \frac{\Delta \omega}{\sqrt{2 \Delta S}} \right),
\end{equation}
where $\erfc(x) = 1 - \erf(x)$ is the complementary error
function whose inversion is also analytical.
With a random $\Delta S$ drawn from this probability distribution,
the value of $S_1$ of the progenitor is then $S_1 = S_2 + \Delta S$,
and the mass of one of the progenitors is determined by
$\sigma^2(M_1) = S_1$, while for the other is $\Delta M = M_2 - M_1$.

Let $M_{\R{main}} \equiv \max(M_1, \Delta M)$ and
$M_{\R{sub}} \equiv \min(M_1, \Delta M)$.
If $M_{\R{sub}} \leq \Delta M_c$, we regard this change in mass
to be due to accretion, and we continue build the merger tree from
$M_{\R{main}}$ with the sub-cluster been ignored.
On the other hand, it is identified as a merger event if
$M_{\R{sub}} > \Delta M_c$, then we trace both the main cluster
and the sub-cluster separately.

Considering that radio halos are only observed in
a fraction of massive merging clusters, suggesting they are closely
related to the recent major mergers, and have a lifetime
$\tau_{\R{halo}}$ shorter than the timescale
$\tau_m$ ($\sim\! \SIrange[range-units=single]{2}{3}{\Gyr}$)
for the duration of merger-induced disturbance \citep{cassano2016}.
Therefore we only trace the merging history of the main cluster
to a maximum backward time of \SI{3}{\Gyr}.
Then we identify the most recent major merger for each cluster,
which is defined as $M_{\R{main}}/M_{\R{sub}} < 3$
\citep[e.g.,][]{wetzel2009},
and extract the $(M_{\R{main}}, M_{\R{sub}}, z_{\R{merger}})$
data for use in the following radio halos simulation.
Meanwhile, those clusters without a recent major merger found
are thought to not host radio halos, and thus been ignored.

We also note that this technique allows only binary mergers,
but it is sufficient for our use here.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Radio Halos}
\label{sec:halo}

Giant radio halos in galaxy clusters are associated with the on-going or
most recent major mergers, and they are widely believed to be radiated from
highly relativistic electrons re-accelerated by the merger-induced
large-scale turbulent fluctuations.
In addition, extended radio emissions of smaller scale (a few hundred kpc),
called mini-halos, have been found in some relaxed cool-core clusters.
We do not account for the radio mini-halos for the moment, and they
seems to have a different origin \citep{feretti2012rev}.

The approach we adopted here to simulate the giant radio halos
was largely inspired by \citet{cassano2005}, but we
made various modifications as well as simplifications for our needs.

For each cluster associated with a recent major merger, we assume that
the two sub-clusters undergo only central collisions.
Starting from an initial distance $d_0$ with zero velocity,
the relative impact velocity of two merging clusters with mass
$M_{\R{main}}$ and $M_{\R{sub}}$ upon collision (at a distance
$R_{\R{main}}$ between the centers) is given by
\citep{cassano2005,sarazin2002}:
\begin{equation}
  \label{eq:v-imp}
  v_{\R{imp}} \simeq \left[
    \frac{2G (M_{\R{main}} + M_{\R{sub}})}{R_{\R{main}}}
    \left( 1 - \frac{1}{\eta_v} \right)\right]^{1/2},
\end{equation}
where $d_0 = \eta_v R_{\R{main}}$,
$\eta_v \simeq 4 (1 + M_{\R{sub}}/M_{\R{main}})^{1/3}$,
and $R_{\R{main}}$ is the virial radius of the main cluster
[see Equation~(\ref{eq:radius-virial})].

Cluster mergers generate turbulence throughout the cluster over
\si{\sim \Mpc} scales.
Energy can be transferred from the ICM into the non-thermal
component through the interactions between electrons and the
magneto-hydrodynamics (MHD) turbulence, which accelerate the electrons
to be extremely relativistic and radiate synchrotron emissions.
This scenario of particle re-acceleration by turbulence is the most
accepted mechanism responsible for the radio halos \citep{feretti2012rev}.

The turbulence re-acceleration likes a second-order Fermi process, i.e.,
related with a random process, may be effective for only a few
\SI{e8}{\year} during a merger, and thus not quite efficient
\citep{feretti2012rev,ensslin2011}.
We approximate the effective acceleration timescale with the merger
crossing time \citep{cassano2005}:
\begin{equation}
  \label{eq:tau-cross}
  \tau_{\R{cross}} \simeq \frac{R_{\R{main}}}{v_{\R{imp}}},
\end{equation}
which is typically $\lesssim \SI{1}{\Gyr}$.
That means that the merger-induced turbulence is assumed to only accelerate
the electrons from time $t_{\R{merger}}$ (when the merger begins at the
redshift $z_{\R{merger}}$) to $t_{\R{merger}} + \tau_{\R{cross}}$.
In addition, we can estimate the electron acceleration coefficient
according to \citep{cassano2005}:
\begin{equation}
  \label{eq:electron-acc}
  \chi(t) \simeq 6.3 \,\eta_{\R{turb}}
      \left( \frac{M_{\R{main}} + M_{\R{sub}}}{\SI{2e15}{\solarmass}} \right)^{3/2}
      \left( \frac{k_BT}{\SI{7}{\keV}} \right)^{-1/2}
      \left( \frac{R_{\R{halo}}}{\SI{500}{\kpc}} \right)^{-1}
  \quad [\si{\per\Gyr}],
\end{equation}
where $\eta_{\R{turb}}$ is a free parameter roughly describing the fraction
of the turbulence energy transformed into accelerating the electrons (i.e.,
an index of the turbulence acceleration efficiency);
and $k_BT$ and $R_{\R{halo}}$ are the mean temperature of the cluster ICM
and the radio halo radius, respectively, which will be explained later.

The time evolution of relativistic electrons spectrum with isotropic energy
distribution can be derived by solving the Fokker-Planck equation
\citep{eilek1991,schlickeiser2002}:
\begin{equation}
  \label{eq:fokkerplanck}
  \pdiff{n(\gamma,t)}{t} = \pdiff{}{\gamma} \left[ n(\gamma,t) \left(
      \left| \diff{\gamma}{t} \right|_{\R{rad}} +
      \left| \diff{\gamma}{t} \right|_{\R{ion}} -
      \frac{2}{\gamma} D_{\R{\gamma\gamma}}(\gamma, t) \right) \right] +
  \pdiff{}{\gamma} \left[ D_{\R{\gamma\gamma}} \pdiff{n(\gamma,t)}{p} \right] +
  Q_e(\gamma,t),
\end{equation}
where $\gamma = p / (m_e c)$ is the Lorentz factor of the electrons,
$n(\gamma, t)$ is the isotropic number density of relativistic
electrons, $Q_e(\gamma, t)$ describes the electron injection,
$|\R{d}\gamma / \R{d}t|_{(\cdot)}$ terms account for the
energy losses due to radiation and ionization,
and $D_{\R{\gamma\gamma}}(\gamma, t)$ is the diffusion coefficient
describing the interactions between electrons and turbulent waves,
which is given by \citep{brunetti2011}:
\begin{equation}
  \label{eq:diffusion-coef}
  D_{\R{\gamma\gamma}}(\gamma, t) = \frac{1}{4} \,\gamma^2\,\chi(t).
\end{equation}
In some energy ranges (e.g., $\gamma \sim 1000$), the diffusion may
contribute more energies than those lost, therefore can accelerate electrons
to higher energies, making them synchrotron bright.

The electrons that will be re-accelerated \emph{in situ}
by the turbulence permeating the cluster ICM, are thought to be
injected by AGN activities (quasars, radio galaxies, etc.), or by
star formation in normal galaxies (supernovae, galactic winds, etc.)
during the cluster life \citep[see][for a review]{blasi2007rev}.
The electrons can be reasonably assumed to be constantly injected
into the cluster ICM with a power-law spectrum of index $s$
\citep{cassano2005,sarazin1999}:
\begin{equation}
  \label{eq:electron-inj}
  Q_e(\gamma, t) = Q_e(\gamma) = K_e \,\gamma^{-s},
\end{equation}
where $K_e$ is the constant injection rate, which can be parametrized
by assuming that the total energy injected in the electrons during
the cluster life is a fraction, $\eta_e$, of the total thermal energy
of the cluster \citep{cassano2005}:
\begin{equation}
  \label{eq:injrate-param}
  \epsilon_e \,\tau_{\R{cluster}} \int_{\gamma_{\R{min}}}^{\gamma_{\R{max}}}
  Q_e(\gamma') \gamma' \,\D{\gamma'} \simeq \eta_e \,\epsilon_{\R{th}},
\end{equation}
where $\tau_{\R{cluster}} \simeq t_0$ is the cluster age at redshift
$z_0$ as simulated in Section~\ref{sec:distributions},
$\epsilon_e = m_e c^2$ is the energy of one electron at still,
$\epsilon_{\R{th}}$ is the thermal energy density of the cluster ICM,
and $\gamma_{\R{min}} \ll \gamma_{\R{\max}}$ are the minimum and maximum
Lorentz factors of the injected electrons, respectively.
Therefore we derive the electron injection rate to be:
\begin{equation}
  \label{eq:injrate}
  K_e \simeq \frac{(s-2)\,\eta_e\,\epsilon_{\R{th}}}{\epsilon_e\,\tau_{\R{cluster}}}
    \gamma_{\R{min}}^{s-2}.
\end{equation}

The ICM thermal energy density is calculated as:
\begin{equation}
  \label{eq:eth}
  \epsilon_{\R{th}} = \frac{3}{2} \,n_{\R{th}} \,k_B T,
\end{equation}
where $n_{\R{th}}$ is the thermal number density [see Equation~(\ref{eq:nth})],
and $k_B T$ is the ICM mean temperature, which is estimated
from the cluster mass using this $M \!-\! T$ scaling relation
\citep{arnaud2005}:
\begin{equation}
  \label{eq:mt-relation}
  \left( \frac{M_{200}}{\SI{e14}{\solarmass}} \right) E(z) = (5.34 \pm 0.22)
  \left( \frac{k_B T}{\SI{5}{\keV}} \right)^{(1.72 \pm 0.10)},
\end{equation}
where $E(z)$ is the redshift evolution factor [see Equation~(\ref{eq:ez-func})].
Note that we approximate the cluster virial mass with $M_{200}$ here.

Observations show that radio halos have a radial size
$R_{\R{halo}} \sim \numrange{3}{6}$ times smaller than the virial radius
$R_{\R{vir}}$, we then estimate the halo radius by
\citep{cassano2007,zandanel2014}:
\begin{equation}
  \label{eq:rhalo-rvir}
  R_{\R{halo}} = \frac{1}{4} R_{\R{vir}}.
\end{equation}
The weak \si{\uG}-level magnetic fields are also observed in clusters.
We assume an uniform magnetic field throughout the ICM,
but allow its strength to scale with the cluster mass as \citep{cassano2012}:
\begin{equation}
  \label{eq:magfield-mass}
  B = B_{\langle{M}\rangle} \left( \frac{M}{\langle{M}\rangle} \right)^b,
\end{equation}
where $\langle {M} \rangle = \SI{1.6e15}{\solarmass}$, and we take
$B_{\langle {M} \rangle} = \SI{1.9}{\uG}$ and $b = 1.5$ in this work
as suggested by \citet{cassano2006}.

On the other hand,
relativistic electrons lose energy via synchrotron radiation
and inverse Compton scattering off the CMB photons \citep{sarazin1999}:
\begin{equation}
  \label{eq:eloss-rad}
  \left( \diff{\gamma}{t} \right)_{\R{rad}} =
  \num{-4.32e-4} \,\gamma^2
  \left[ \left( \frac{B}{\SI{3.25}{\uG}} \right)^2 +
  (1+z)^4 \right] \quad [\si{\per\Gyr}],
\end{equation}
where $B$ is the magnetic field strength in the ICM.
Meanwhile, electrons in the ICM also lose energy through
ionization and Coulomb collisions \citep{sarazin1999}:
\begin{equation}
  \label{eq:eloss-ion}
  \left( \diff{\gamma}{t} \right)_{\R{ion}} =
  \num{-3.79e4} \,n_{\R{th}} \left[ 1 +
    \frac{\ln(\gamma/n_{\R{th}})}{75} \right] \quad [\si{\per\Gyr}],
\end{equation}
with $n_{\R{th}}$ in units of [\si{\per\cm\cubed}].

Having all the coefficients of the Fokker-Planck
equation~(\ref{eq:fokkerplanck}) been determined, we can now derive
the time evolution of the electron spectrum.
An efficient numerical method proposed by \citet{chang1970} is
utilized to solve the Fokker-Planck equation, under the no-flux boundary
condition \citep{park1996}.
However, to avoid unphysical pile-up of electrons at the lower boundary,
we define a \enquote{buffer} region below $\gamma_{\R{buf}}$, within which
the spectrum are replaced by extrapolating as a power law, based on
the spectrum above $\gamma_{\R{buf}}$ \citep{donnert2014}.
We adopt a logarithmic grid for $\gamma \in [10, 10^5]$ with 200 cells,
and let the lower buffer region span 5 cells.

We solve the Fokker-Planck equation from the time $t_{\R{merger}}$
(i.e., $z_{\R{merger}}$) when the identified major merger begins,
until to the time $t_0$ (i.e., $z_0$) which corresponds to the current
time of our simulated \enquote{observations.}
The low-energy electrons (e.g., $\gamma \sim 300$) have very long
lifetimes, they may be accumulated and retained as the cluster
grows \citep{sarazin1999}.
We therefore estimate the initial electron spectrum at $t_{\R{merger}}$ as:
\begin{equation}
  \label{eq:ne-init}
  n(\gamma, t=t_{\R{merger}}) = t_{\R{merger}} K_e \,\gamma^{-s}.
\end{equation}

Once the current electron spectrum $n(\gamma, t_0)$ been derived,
the synchrotron emissivity in units of
[\si{\erg\per\second\per\cm\cubed\per\hertz}],
is determined by \citep{rybicki1979}:
\begin{equation}
  \label{sec:jnu-sync}
  J_{\R{syn}}(\nu, t_0) = \frac{\sqrt{3} \, e^3 B}{m_e c^2}
  \int_{\gamma_{\R{min}}}^{\gamma_{\R{max}}} \int_0^{\pi/2}
  n(\gamma, t_0) F\!\left( \frac{\nu}{\nu_c} \right) \sin^2 \!\theta
  \,\D{\theta} \,\D{\gamma},
\end{equation}
where $F(\nu/\nu_c)$ is the synchrotron kernel:
\begin{equation}
  \label{eq:sync-kernel}
  F\!\left( \frac{\nu}{\nu_c} \right) = \frac{\nu}{\nu_c}
  \int_{\nu/\nu_c}^{\infty} K_{5/3}(y) \,\D{y},
\end{equation}
with $K_{5/3}(x)$ the modified Bessel function of 5/3 order,
$\nu_c = (3/2) \,\gamma^2 \nu_L \sin\theta$ the critical frequency,
and $\nu_L = e B / (2\pi m_e c)$ the Larmor frequency of electrons.
Observations suggest that radio halos have average synchrotron emissivity
$\langle {J_{\R{syn}}} \rangle \sim \SI{e-42}{\erg\per\second\per\cm\cubed\per\hertz}$
at 1.4 GHz \citep{murgia2009,feretti2012rev}.

The synchrotron emissivity is the same throughout the radio halo,
according to our previous assumptions, we can then calculate the radio
power at a specific frequency (i.e., spectral luminosity) as:
\begin{equation}
  \label{eq:halo-power}
  P_{\nu} \equiv P(\nu) = \frac{4\pi}{3} R_{\R{halo}}^3 J_{\R{syn}}(\nu),
\end{equation}
and the halo flux density $S_{\nu}$ is given by:
\begin{equation}
  \label{eq:halo-flux-density}
  S_{\nu} = \frac{P_{\nu}}{4\pi D_L^2},
\end{equation}
where $D_L$ is the luminosity distance to the halo at redshift $z_0$.
We adopt the exponential profile for the azimuthally averaged brightness
distribution of radio halos, which is expressed as \citep{murgia2009}:
\begin{equation}
  \label{eq:halo-exprofile}
  I_{\nu}(\theta) = I_{\nu,0} \exp(-\theta/\theta_e),
\end{equation}
where $\theta = R / D_A$ is the angular radius from the halo center,
with $D_A$ the angular diameter distance to the halo,
$\theta_e \simeq \theta_{\R{halo}}/3$ is the $e$-folding radius,
and $I_{\nu,0}$ is the central brightness, which is constrained by the
above flux density $S_{\nu}$ and can be derived to be:
\begin{equation}
  \label{eq:central-brightness}
  I_{\nu,0} = \frac{S_{\nu}}{2\pi \,\theta_e^2}.
\end{equation}

Finally, we simulate the appearance of each radio halo as an ellipse by
randomly assigning an ellipticity $f_e$ and a rotation angle $\phi$,
and then superimpose all the halo images to the sky patch to obtain the
simulated images of radio halos at each frequency of interest.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Radio Relics}
\label{sec:relic}

\TODO{Simulate (elongated) radio relics...}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% BEGIN: [7th->8th]
\color{magenta}
\section{EoR Signal Simulation}
\label{sec:eor-simulation}

We simulate the cosmological EoR signal using the \texttt{SimFast21}
(version 20170627) software, which can perform fast simulations to the
\Hi{} \SI{21}{\cm} signal during and prior to the EoR by utilizing a
semi-numerical scheme \citep{santos2010,hassan2016}.
\texttt{SimFast21} generates 3D realizations of the dark matter density
fields and models their evolution to determine the collapsed dark matter
halos using an excursion-set algorithm, then derives the ionizing sources
and their time evolution, from which the final brightness temperature of
the \SI{21}{\cm} signal is obtained \citep{santos2010}.

In this work, we simulated a cube of \SI{500}{\cMpc} (comoving \si{\Mpc})
and 500 cells along each side.  \texttt{SimFast21} performed the
simulation from redshift $z=9$ to $z=7$ with a step of $\Delta z = 0.1$,
and produced a set of so-called \enquote{coeval cubes} containing the
\SI{21}{\cm} signal brightness temperature distribution at a single
look-back time (i.e., same cosmological redshift) for each of them.
These simulated coeval cubes cannot been observed in practice, but the
observable \enquote{light-cone cube} can be created from them using the
method outlined by \citet{datta2012}.
From the light-cone cube, we extract the brightness temperature slices
at requested frequencies by interpolating along the comoving distance
(i.e., redshift).
We note that these extracted slices only have an angular size of
\SI{\sim 3}{\deg} (observed at \SI{158}{\MHz}), which is much smaller
than our needs.  Therefore, we tile and re-scale these slices to make
them have the same angular and image sizes as our foreground maps.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Observation Simulation}
\label{sec:obs-simulation}

To investigate the practical contamination in the EoR window due to the
galaxy clusters, we need to simulate the \enquote{observed} images of
the above simulated foreground sky and EoR signal.
For this purpose,
we adopt the latest SKA1-Low layout configuration\footnote{%
  SKA-TEL-SKO-0000422: SKA1-low Configuration Coordinates: \url{https://astronomers.skatelescope.org/wp-content/uploads/2016/09/SKA-TEL-SKO-0000422_02_SKA1_LowConfigurationCoordinates-1.pdf}}
released on 2016 May 21.
The SKA1-Low interferometer consists of 512 stations, with 224 of them
randomly distributed within the \enquote{core} of \SI{1000}{\meter} in
diameter, while rest of the stations are grouped into \enquote{clusters}
and arranged on 3 spiral arms extending up to a radius of
\SI{\sim 35}{\kilo\meter}.
Each station has 256 antennas randomly distributed with a minimum separation
of $d_{\R{min}} = \SI{1.5}{\meter}$ inside a circular region of
\SI{35}{\meter} in diameter.
With this layout configuration, the dense core makes the SKA1-Low very
sensitive to the EoR signal, while the long baselines greatly help the
foreground characterization and removal, as well as other scientific goals.
For example, at \SI{158}{\MHz}, the SKA1-Low has a FoV of
\SI{\sim 4 x 4}{\deg}, and angular resolution of \SI{\sim 7}{\arcsec}.

Both the observation simulation and imaging are very computational
intensive, but our computing resources are rather limited, so we can
only choose a set of conservative parameters.
The \SIrange{154}{162}{\MHz} band of our interest is divided into 51
channels with a frequency channel width of \SI{160}{\kilo\hertz}.
The sky maps simulated in previous sections are centered at (R.A., Dec.)
= (\SI{0}{\degree}, \SI{-27}{\degree}), such that the observing field
will pass through the zenith of the interferometer, and this position
is also the center of the \enquote{EoR0} field identified by the MWA
\citep{beardsley2016}.
At each frequency channel, the sky map is tapered by a Tukey window
function to suppress the side-lobe impacts, and then input into the
\texttt{OSKAR} simulator \citep{mort2010} to perform the observation
for \SI{6}{\hour} ($\pm \SI{3}{\hour}$ in Hour Angle) with a time
averaging step of \SI{2}{\minute}.

The simulated visibility data at each frequency channel are combined
to create the \enquote{observed} image cube using the \texttt{WSClean}
imager \citep{offringa2014} with Briggs weighting and joined-channel
deconvolution \citep{offringa2017}.
Finally, we crop out the central \SI{4 x 4}{\deg} to create the 2D
cylindrical power spectrum, as described in Appendix~\ref{sec:power-spectrum}.

\color{black}
%% END: [7th->8th]


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Results}
\label{sec:results}

\TODO{Write!!!}

\TODO{Distribute the results (e.g., simulated images) into previous sections,
  and then merge this section (e.g., scaling relations and comparisons)
  with the next `discussions' section???}

\NOTE{Collect all the parameters (e.g., fg21sim, SimFast21, OSKAR, WSClean)
  as well as the input data/templates into to the Appendix!
  Also create a page in the software repository to hold further information.}

On the foregrounds simulation part, compare our simulated radio halos with
current observations as well as previous results,
e.g., halo luminosity function, (and ???).

Then we evaluate the impacts of radio halos on EoR detection in both the
image domain and the (2D) power spectrum domain:
\begin{description}
  \item[Image]
    Take the above simulated image cube, subtract the spectral-smooth
    foregrounds fitting a smooth polynomial along the frequency axis,
    evaluate the loss of EoR signals (use image-domain indexes???
    can also use the total power spectrum???)

    May consider too cases: (1) only radio halos is superimposed onto the
    EoR signals; (2) radio halos as well as Galactic foregrounds are
    added to the EoR signals.

  \item[Power spectrum]
    Take the above simulated image cube, calculate the 2D
    (i.e., cylindrically averaged) power spectrum, evaluate the foregrounds
    contamination within the (theoretically predicted) EoR window,
    compare to the case that only EoR signals exist in the EoR windows.
\end{description}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Discussions}
\label{sec:discussions}

\TODO{Write!!!}

\NOTE{Current limitations???}

%% TODO: future works/improvements:
One of the main purposes of our foregrounds simulation is to support
the development and evaluation of foregrounds removal or separation
methods in our forthcoming works.
We will combine our foregrounds simulation with interferometric
observation simulation, to generate the \enquote{observed} visibility
data as well as images (e.g., by using the \textsc{clean} algorithm).
In this way, we incorporate the realistic instrumental effects into
our simulation pipeline, making our developed methods more versatile
and prepare for future real observations.
(\NOTE{Move this paragraph to above simulation section?})

In addition to the foregrounds removal aiming at the EoR signal
detection, the methods to effectively identify and extract the faint
extended radio emissions (e.g., halos, relics) from observation images
is of the same importance.
With future more sensitive observations combined with a better detection
method, we are able to build a big sample of galaxy clusters, which
may provide us with plenty of opportunities to study them in the radio
regime.

Moreover, there is still much room to improve the current foregrounds
simulation, e.g., taking radio relics into account, more realistic
source morphologies by utilizing the deep learning techniques,
full polarization support.
We will continue to improve our foregrounds simulation works and make
them available in our public software \texttt{fg21sim} in the future.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Conclusions}
\label{sec:conclusions}

\TODO{Write!!!}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% If you wish to include an acknowledgments section in your paper,
%% separate it off from the body of the text using the \acknowledgments
%% command.
\acknowledgments

\TODO{[update]}
We acknowledge ...
%% BEGIN: [7th->8th]
\color{magenta}
We give thanks
to Mathieu Remazeilles for making us the high-resolution Haslam \SI{408}{\MHz}
Galactic synchrotron map with small-scale fluctuations added,
to Giovanna Giardino for providing us with the all-sky Galactic synchrotron
spectral index map,
to Fred Dulwich for sharing the latest SKA1-Low layout configuration as well
as the guidance on using the \texttt{OSKAR} simulator.
We also thank Andr\'e Offringa and Emma Chapman for their help.
This work is supported by the National Science Foundation of China
(grant Nos. xxx, xxx).
\color{black}
%% END: [7th->8th]


%% To help institutions obtain information on the effectiveness of their
%% telescopes the AAS Journals has created a group of keywords for telescope
%% facilities:
%% http://journals.aas.org/authors/aastex/facility.html
%
%% Following the acknowledgments section, use the following syntax and the
%% \facility{} or \facilities{} macros to list the keywords of facilities used
%% in the research for the paper.  Each keyword is check against the master
%% list during copy editing.  Individual instruments can be provided in
%% parentheses, after the keyword, but they are not verified.

\vspace{5mm}

% \facilities{???}

%% Similar to \facility{}, there is the optional \software command to allow
%% authors a place to specify which programs were used during the creation of
%% the manusscript. Authors should list each code and include either a
%% citation or url to the code inside ()s when available.

\software{
  Astropy \citep{astropy2013},
  NumPy (\url{http://www.numpy.org/}),
  Vim (\url{http://www.vim.org/}),
  Emacs (\url{https://www.gnu.org/s/emacs/}),
  OSKAR, WSClean, IPython, Jupyter Notebook, Matplotlib, ...
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%% Appendix material should be preceded with a single \appendix command.
%% There should be a \section command for each appendix. Mark appendix
%% subsections with the same markup you use in the main body of the paper.
%%
%% Each Appendix (indicated with \section) will be lettered A, B, C, etc.
%% The equation counter will reset when it encounters the \appendix
%% command and will number appendix equations (A1), (A2), etc. The
%% Figure and Table counter will not reset.
%%
\appendix

\section{List of Current Observed Radio Halos}
\label{sec:halos-collection}

\TODO{Compile the current observed (giant) radio halos ...}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Useful Formulas}
\label{sec:formulas}

In this section we collect some useful formulas we made use of in our
simulations.

The Hubble parameter at redshift $z$:
\begin{equation}
  \label{eq:hubble-z}
  H(z) = H_0 E(z),
\end{equation}
where $H_0$ is the present-day Hubble value,
and $E(z)$ is the redshift evolution factor given by:
\begin{equation}
  \label{eq:ez-func}
  E(z) = \sqrt{\Omega_m(1+z)^3 + \Omega_{\Lambda}}.
\end{equation}
(Note that we adopt a flat \lcdm{} cosmology so that
$\Omega_k = 1 - \Omega_m - \Omega_{\Lambda} = 0$.)

The critical density of the Universe at redshift $z$ is:
\begin{equation}
  \label{eq:rho-crit}
  \rho_{\R{crit}}(z) = \frac{3 H^2(z)}{8 \pi G},
\end{equation}
where $G$ is the gravitational constant.

On the other hand, the critical linear overdensity as a function of
redshift $z$ is \citep{kitayama1996,randall2002}:
\begin{equation}
  \label{eq:delta-crit}
  \delta_c(z) = \frac{D(z=0)}{D(z)}
  \left[ \frac{3 (12\pi)^{2/3}}{20} \right]
  \left[1 + 0.0123 \log_{10} \Omega_f(z) \right],
\end{equation}
where $\Omega_f(z)$ is the mass density ratio at redshift $z$:
\begin{equation}
  \label{eq:omega-fz}
  \Omega_f(z) = \frac{\Omega_m(1+z)^3}{\Omega_m(1+z)^3 + \Omega_{\Lambda}},
\end{equation}
and $D(z)$ is the growth factor given by
\citep[Equation~(13.6)]{peebles1980}:
\begin{equation}
  \label{eq:growth-factor}
  D(x) = \frac{(x^3 + 2)^{1/2}}{x^{3/2}}
    \int_0^x y^{3/2} (y^3 + 2)^{-3/2} \,\D{y},
\end{equation}
with $x_0 \equiv (2\Omega_{\Lambda}/\Omega_m)^{1/3}$ and
$x = x_0 / (1+z)$.

The virial radius of a cluster is:
\begin{equation}
  \label{eq:radius-virial}
  R_{\R{vir}} = \left[
    \frac{3 M_{\R{vir}}}{4\pi \Delta_{\R{vir}}(z) \rho_{\R{crit}}(z)}
  \right]^{1/3},
\end{equation}
where $M_{\R{vir}}$ is the virial mass (can also be regarded as
the total mass) of the cluster,
$\rho_{\R{crit}}(z)$ is the critical density at redshift $z$,
and $\Delta_{\R{vir}}(z)$ is the average overdensity of the cluster
at redshift $z$ given by \citep{kitayama1996,cassano2005}:
\begin{equation}
  \label{eq:delta-vir}
  \Delta_{\R{vir}}(z) = 18\pi^2 \left[ 1 + 0.4093 \, w(z)^{0.9052} \right],
\end{equation}
where $w(z) \equiv \Omega_f^{-1}(z) - 1$.

The thermal number density of the cluster ICM is approximately given by:
\begin{equation}
  \label{eq:nth}
  n_{\R{th}} \simeq
    \frac{3 M_{\R{baryon}}}{4\pi \mu m_u R_{\R{vir}}^3},
\end{equation}
where $\mu \simeq 0.6$ is the mean molecular weight \citep{ettori2013},
$m_u$ is the atomic mass unit,
and $M_{\R{baryon}} \simeq M_{\R{vir}} f_b$ is the baryon mass
of the cluster with $f_b \simeq \Omega_b / \Omega_m$ the mean baryon
fraction assumed for clusters.

In a flat \lcdm{} cosmology as we adopted, the age of the Universe
at redshift $z$ takes an analytical form
\citep[their Equation~(18)]{thomas2000}:
\begin{align}
  \label{eq:universe-age}
  t(z; \Omega_m, \Omega_{\Lambda}=1-\Omega_m)
    & = \frac{1}{H_0} \int_z^{\infty}
      \frac{\D{z'}}{(1+z')\sqrt{1 + \Omega_m z' (3+3z'+z'^2)}} \nonumber \\
    & = \frac{2}{3 H_0 \sqrt{1-\Omega_m}} \sinh^{-1} \!\left(
      \sqrt{\frac{\Omega_m^{-1} - 1}{(1+z)^3}} \right).
\end{align}
This formula can also be inverted analytically to derive the redshift
$z$ corresponding to a cosmic time $t$ (i.e., age of the Universe),
which is used in our building of cluster merger trees
in Section~\ref{sec:merging-history}.

The \emph{angular diameter distance} $D_A$ is defined as the ratio of
an object's physical transverse size to its (observed) angular size
(in radians).  Note that it does \emph{not} increases indefinitely
as $z \to \infty$, therefore more distant (e.g., $z > 1$)
objects of same physical size may actually appear larger!
The angular diameter distance is used to convert the observed angular
separations between sources into their proper separations, and it is
related to the \emph{transverse comoving distance} $D_M$ by
\citep{weinberg1972,peebles1993,hogg1999}:
\begin{equation}
  \label{eq:da-dm}
  D_A(z) = \frac{D_M(z)}{1 + z}.
\end{equation}

The \emph{luminosity distance} $D_L$ is defined by the relationship
between the measured bolometric (i.e., integrated over all frequencies)
flux $S_{\R{bolo}}$ and the object's intrinsic bolometric luminosity
$L_{\R{bolo}}$:
\begin{equation}
  \label{eq:dl-def}
  D_L \equiv \sqrt{\frac{L_{\R{bolo}}}{4\pi S_{\R{bolo}}}}.
\end{equation}
And it is related to the transverse comoving distance and angular
diameter distance by \citep{weinberg1972,hogg1999,ellis2007}:
\begin{equation}
  \label{eq:dl-dm-da}
  D_L(z) = (1+z) D_M(z) = (1+z)^2 D_A(z).
\end{equation}

In the radio frequency regime, the Rayleigh-Jeans approximation
always holds, therefore the spectral brightness $I_{\nu}$ can be
equivalently expressed by \emph{brightness temperature} $T_b(\nu)$
through the relation \citep{condon2016}:
\begin{equation}
  \label{eq:brightness-temp}
  T_b(\nu) \equiv \frac{I_{\nu} c^2}{2 k_B \nu^2}.
\end{equation}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% BEGIN: [7th->8th]
\color{magenta}
\section{EoR Signal Power Spectrum}
\label{sec:power-spectrum}

\TODO{draw a diagram}

The EoR signal is the redshifted \SI{21}{\cm} line emission from \Hi{},
which is observed by a radio interferometer and form an image cube
$I(\bm{\theta}, \nu)$, where the two angular dimensions $\bm{\theta}$
translate into the transverse distances $\bm{r}_{\bot}$ on the sky plane,
and the spectral dimension $\nu$ represents the line-of-sight distance
$r_{\parallel}$.

First, we take the 3D Fourier transform on the image cube:
\begin{equation}
  \label{eq:ps-3d-ft}
  V(\bm{u}, \eta) = \bm{\mathrm{F}}(\{\bm{u}, \eta\}, \{\bm{\theta}, \nu\})
    I(\bm{\theta}, \nu),
\end{equation}
where $\bm{\theta}$ is the angular sizes on the sky plane, $\nu$ is the
frequency, and $(\bm{u}, \eta)$ are the Fourier duals to
$(\bm{\theta}, \nu)$, respectively.
Then we transform the coordinate from $(\bm{u}, \eta)$ into the
cosmological coordinate $\bm{k} = (k_x, k_y, k_z)$
(in units of \si{\per\cMpc}):
\begin{equation}
  \label{eq:coordinate-transform}
  V(\bm{k}) = \bm{\mathrm{J}}(\bm{k}, \{\bm{u}, \eta\}) V(\bm{u}, \eta).
\end{equation}
\TODO{[add coordinate transformation]}
We therefore obtain the 3D power spectrum by:
\begin{equation}
  \label{eq:3d-ps}
  P(\bm{k}) = |V(\bm{k})|^2.
\end{equation}

Considering that the signal is isotropic among the sky plane, we can
squeeze these two dimensions into $\kperp \equiv \sqrt{k_x^2 + k_y^2}$ by
cylindrically averaging the 3D power spectrum, and obtained the 2D
cylindrical power spectrum $P(\kperp, \klos)$ with $\klos \equiv k_z$.
The 2D cylindrical power spectrum has the advantage to better separate
the EoR signal from the foreground contamination, which is supposed to
be reside in the lower-right wedge-shape region, therefore defining the
EoR window.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Simulation Parameters}
\label{sec:parameters}

\TODO{Collect and explain the simulation parameters ...}


\color{black}
%% END: [7th->8th]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliography{references}


%% Include this line if you are using the \added, \replaced, \deleted
%% commands to see a summary list of all changes at the end of the article.
%\listofchanges

\end{document}

%% EOF
